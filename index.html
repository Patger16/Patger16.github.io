<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-en="Fitness & Nutrition Tracker" data-de="Fitness- & Ernährungs-Tracker">Fitness- & Ernährungs-Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Farbpalette: Energetic & Playful */
        /* Grün: #10B981 (Emerald-500) - Akzentfarbe, Buttons */
        /* Dunkelgrün: #065f46 (Emerald-800) - Überschriften, starke Akzente */
        /* Hellgrün: #D1FAE5 (Emerald-100) - Hintergründe für Highlight-Boxen */
        /* Blau: #3B82F6 (Blue-500) - Sekundäre Akzente */
        /* Gelb: #F59E0B (Yellow-500) - Warnungen */
        /* Grau: #F9FAFB (Gray-50) - Hintergrund */
        /* Dunkelgrau: #1F2937 (Gray-800) - Text */

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1F2937;
            background-color: #F9FAFB;
        }
        .container {
            max-width: 1000px; /* Slightly wider for more content */
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4 {
            color: #065f46; /* Emerald-800 */
            margin-bottom: 0.5em;
        }
        h1 {
            font-size: 2.8em;
            text-align: center;
            margin-bottom: 1em;
            color: #065f46;
        }
        h2 {
            font-size: 2.2em;
            border-bottom: 2px solid #10B981; /* Emerald-500 */
            padding-bottom: 0.3em;
            margin-top: 2em;
            margin-bottom: 1em;
        }
        h3 {
            font-size: 1.6em;
            color: #059669; /* Emerald-600 */
            margin-top: 1.5em;
            margin-bottom: 0.8em;
        }
        h4 {
            font-size: 1.3em;
            color: #047857; /* Emerald-700 */
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        p, li, table {
            font-size: 1.05em;
            margin-bottom: 0.5em;
        }
        .card {
            background-color: white;
            border-radius: 12px; /* Softer Material Design look */
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); /* Stronger shadow for elevation */
        }
        .highlight {
            background-color: #D1FAE5; /* Emerald-100 */
            padding: 15px;
            border-left: 5px solid #10B981; /* Emerald-500 */
            border-radius: 8px;
            margin-bottom: 20px;
        }
        input[type="number"], input[type="text"], select {
            padding: 10px;
            border: 1px solid #D1D5DB; /* Gray-300 */
            border-radius: 6px;
            font-size: 1em;
            color: #1F2937;
            background-color: #F9FAFB;
        }
        button {
            background-color: #10B981; /* Emerald-500 */
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover {
            background-color: #059669; /* Emerald-600 */
            transform: translateY(-1px);
        }
        button:active {
            background-color: #047857; /* Emerald-700 */
            transform: translateY(0);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
            background-color: white;
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners */
        }
        th, td {
            border: 1px solid #E5E7EB; /* Gray-200 */
            padding: 12px 15px;
            text-align: left;
        }
        th {
            background-color: #F3F4F6; /* Gray-100 */
            font-weight: 600;
            color: #374151; /* Gray-700 */
        }
        .note {
            font-style: italic;
            color: #6B7280; /* Gray-500 */
        }
        .important {
            font-weight: bold;
            color: #DC2626; /* Red-600 */
        }
        .lang-switcher button {
            background-color: #3B82F6; /* Blue-500 */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: normal;
        }
        .lang-switcher button:hover {
            background-color: #2563EB; /* Blue-600 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px; /* Max width for chart to prevent overstretching */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Fixed height for consistency */
            max-height: 400px;
            margin-top: 1.5em;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }
        .meal-item {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .meal-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .meal-item.selected {
            border: 2px solid #10B981;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <div class="lang-switcher text-right mb-6 flex justify-end items-center gap-2">
            <button onclick="setLanguage('de')" class="mr-2" data-en="German" data-de="Deutsch">Deutsch</button>
            <button onclick="setLanguage('en')" data-en="English" data-de="Englisch">Englisch</button>
        </div>

        <h1 data-en="Fitness & Nutrition Tracker" data-de="Fitness- & Ernährungs-Tracker">Fitness- & Ernährungs-Tracker</h1>

        <section class="card">
            <h2 data-en="Your Profile" data-de="Dein Profil">Dein Profil</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 data-en="Your Data" data-de="Deine Daten">Deine Daten</h3>
                    <div class="mb-4">
                        <label for="yourAge" class="block text-gray-700 text-sm font-bold mb-2" data-en="Age (years)" data-de="Alter (Jahre)">Alter (Jahre)</label>
                        <input type="number" id="yourAge" class="w-full" min="1" value="27" oninput="calculateAndDisplayData('you')">
                    </div>
                    <div class="mb-4">
                        <label for="yourHeight" class="block text-gray-700 text-sm font-bold mb-2" data-en="Height (cm)" data-de="Größe (cm)">Größe (cm)</label>
                        <input type="number" id="yourHeight" class="w-full" min="100" value="187" oninput="calculateAndDisplayData('you')">
                    </div>
                    <div class="mb-4">
                        <label for="yourWeight" class="block text-gray-700 text-sm font-bold mb-2" data-en="Weight (kg)" data-de="Gewicht (kg)">Gewicht (kg)</label>
                        <input type="number" id="yourWeight" class="w-full" min="30" value="94" oninput="calculateAndDisplayData('you')">
                    </div>
                    <div class="mb-4">
                        <label for="yourActivity" class="block text-gray-700 text-sm font-bold mb-2" data-en="Activity Level" data-de="Aktivitätslevel">Aktivitätslevel</label>
                        <select id="yourActivity" class="w-full" onchange="calculateAndDisplayData('you')">
                            <option value="1.2" data-en="Sedentary (little or no exercise)" data-de="Sesshaft (wenig bis keine Bewegung)">Sesshaft (wenig bis keine Bewegung)</option>
                            <option value="1.375" data-en="Lightly active (light exercise/sports 1-3 days/week)" data-de="Leicht aktiv (leichter Sport 1-3 Tage/Woche)">Leicht aktiv (leichter Sport 1-3 Tage/Woche)</option>
                            <option value="1.55" selected data-en="Moderately active (moderate exercise/sports 3-5 days/week)" data-de="Mäßig aktiv (moderater Sport 3-5 Tage/Woche)">Mäßig aktiv (moderater Sport 3-5 Tage/Woche)</option>
                            <option value="1.725" data-en="Very active (hard exercise/sports 6-7 days/week)" data-de="Sehr aktiv (intensiver Sport 6-7 Tage/Woche)">Sehr aktiv (intensiver Sport 6-7 Tage/Woche)</option>
                            <option value="1.9" data-en="Extremely active (hard daily exercise/physical job)" data-de="Extrem aktiv (tägl. intensiver Sport/körperliche Arbeit)">Extrem aktiv (tägl. intensiver Sport/körperliche Arbeit)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="yourCalorieGoal" class="block text-gray-700 text-sm font-bold mb-2" data-en="Target Calorie Intake" data-de="Ziel-Kalorienzufuhr">Ziel-Kalorienzufuhr</label>
                        <input type="number" id="yourCalorieGoal" class="w-full" value="2550" oninput="saveUserData()">
                    </div>
                </div>
                <div>
                    <h3 data-en="Your Results" data-de="Deine Ergebnisse">Deine Ergebnisse</h3>
                    <div class="highlight">
                        <p><strong data-en="Goal:" data-de="Ziel:">Ziel:</strong> <span data-en="Weight Loss & Muscle Gain" data-de="Gewichtsreduktion & Muskelaufbau">Gewichtsreduktion & Muskelaufbau</span></p>
                        <p><strong data-en="BMI:" data-de="BMI:">BMI:</strong> <span id="yourBMI"></span> kg/m² <span class="note" id="yourBMICategory"></span></p>
                        <p><strong data-en="BMR:" data-de="BMR:">BMR:</strong> <span id="yourBMR"></span> kcal/Tag</p>
                        <p><strong data-en="TDEE:" data-de="TDEE:">TDEE:</strong> <span id="yourTDEE"></span> kcal/Tag</p>
                        <p class="mt-2"><strong data-en="Recommended for Weight Loss:" data-de="Empfehlung zum Abnehmen:">Empfehlung zum Abnehmen:</strong> <span id="yourRecommendedLoss" class="font-semibold text-green-700"></span></p>
                        <p class="mt-2"><strong data-en="Your Target Weight:" data-de="Dein Zielgewicht:">Dein Zielgewicht:</strong> <span data-en="approx. 80-84 kg" data-de="ca. 80-84 kg">ca. 80-84 kg</span></p>
                    </div>
                    <button onclick="saveUserData()" class="w-full mt-4" data-en="Save Your Profile" data-de="Profil speichern">Profil speichern</button>
                </div>
            </div>
        </section>

        <section class="card">
            <h2 data-en="Brother's Profile" data-de="Profil deines Bruders">Profil deines Bruders</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 data-en="Brother's Data" data-de="Daten deines Bruders">Daten deines Bruders</h3>
                    <div class="mb-4">
                        <label for="brotherAge" class="block text-gray-700 text-sm font-bold mb-2" data-en="Age (years) (Assumed: 25)" data-de="Alter (Jahre) (Angenommen: 25)">Alter (Jahre) (Angenommen: 25)</label>
                        <input type="number" id="brotherAge" class="w-full" min="1" value="25" oninput="calculateAndDisplayData('brother')">
                    </div>
                    <div class="mb-4">
                        <label for="brotherHeight" class="block text-gray-700 text-sm font-bold mb-2" data-en="Height (cm)" data-de="Größe (cm)">Größe (cm)</label>
                        <input type="number" id="brotherHeight" class="w-full" min="100" value="194" oninput="calculateAndDisplayData('brother')">
                    </div>
                    <div class="mb-4">
                        <label for="brotherWeight" class="block text-gray-700 text-sm font-bold mb-2" data-en="Weight (kg)" data-de="Gewicht (kg)">Gewicht (kg)</label>
                        <input type="number" id="brotherWeight" class="w-full" min="30" value="80" oninput="calculateAndDisplayData('brother')">
                    </div>
                    <div class="mb-4">
                        <label for="brotherActivity" class="block text-gray-700 text-sm font-bold mb-2" data-en="Activity Level" data-de="Aktivitätslevel">Aktivitätslevel</label>
                        <select id="brotherActivity" class="w-full" onchange="calculateAndDisplayData('brother')">
                            <option value="1.2" data-en="Sedentary (little or no exercise)" data-de="Sesshaft (wenig bis keine Bewegung)">Sesshaft (wenig bis keine Bewegung)</option>
                            <option value="1.375" data-en="Lightly active (light exercise/sports 1-3 days/week)" data-de="Leicht aktiv (leichter Sport 1-3 Tage/Woche)">Leicht aktiv (leichter Sport 1-3 Tage/Woche)</option>
                            <option value="1.55" selected data-en="Moderately active (moderate exercise/sports 3-5 days/week)" data-de="Mäßig aktiv (moderater Sport 3-5 Tage/Woche)">Mäßig aktiv (moderater Sport 3-5 Tage/Woche)</option>
                            <option value="1.725" data-en="Very active (hard exercise/sports 6-7 days/week)" data-de="Sehr aktiv (intensiver Sport 6-7 Tage/Woche)">Sehr aktiv (intensiver Sport 6-7 Tage/Woche)</option>
                            <option value="1.9" data-en="Extremely active (hard daily exercise/physical job)" data-de="Extrem aktiv (tägl. intensiver Sport/körperliche Arbeit)">Extrem aktiv (tägl. intensiver Sport/körperliche Arbeit)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="brotherCalorieGoal" class="block text-gray-700 text-sm font-bold mb-2" data-en="Target Calorie Intake" data-de="Ziel-Kalorienzufuhr">Ziel-Kalorienzufuhr</label>
                        <input type="number" id="brotherCalorieGoal" class="w-full" value="3250" oninput="saveUserData()">
                    </div>
                </div>
                <div>
                    <h3 data-en="Brother's Results" data-de="Ergebnisse deines Bruders">Ergebnisse deines Bruders</h3>
                    <div class="highlight">
                        <p><strong data-en="Goal:" data-de="Ziel:">Ziel:</strong> <span data-en="Muscle Gain" data-de="Muskelaufbau">Muskelaufbau</span></p>
                        <p><strong data-en="BMI:" data-de="BMI:">BMI:</strong> <span id="brotherBMI"></span> kg/m² <span class="note" id="brotherBMICategory"></span></p>
                        <p><strong data-en="BMR:" data-de="BMR:">BMR:</strong> <span id="brotherBMR"></span> kcal/Tag</p>
                        <p><strong data-en="TDEE:" data-de="TDEE:">TDEE:</strong> <span id="brotherTDEE"></span> kcal/Tag</p>
                        <p class="mt-2"><strong data-en="Recommended for Muscle Gain:" data-de="Empfehlung zum Muskelaufbau:">Empfehlung zum Muskelaufbau:</strong> <span id="brotherRecommendedGain" class="font-semibold text-blue-700"></span></p>
                        <p class="mt-2"><strong data-en="His Target Weight:" data-de="Sein Zielgewicht:">Sein Zielgewicht:</strong> <span data-en="approx. 80-90 kg (focus on composition)" data-de="ca. 80-90 kg (Fokus auf Komposition)">ca. 80-90 kg (Fokus auf Komposition)</span></p>
                    </div>
                    <button onclick="saveUserData()" class="w-full mt-4" data-en="Save Brother's Profile" data-de="Profil des Bruders speichern">Profil des Bruders speichern</button>
                </div>
            </div>
        </section>

        <section class="card">
            <h2 data-en="Meal Portfolio" data-de="Essensportfolio">Essensportfolio</h2>
            <p class="mb-4" data-en="Here is a selection of meal ideas with example nutritional values. Adjust portion sizes to fit your individual calorie and macro goals. Note: These values are examples and should be verified for your actual recipes." data-de="Hier ist eine Auswahl an Gerichtideen mit Beispiel-Nährwerten. Passt Portionsgrößen an eure individuellen Kalorien- und Makroziele an. Hinweis: Diese Werte sind Beispiele und sollten für eure tatsächlichen Rezepte überprüft werden.">Hier ist eine Auswahl an Gerichtideen mit Beispiel-Nährwerten. Passt Portionsgrößen an eure individuellen Kalorien- und Makroziele an. Hinweis: Diese Werte sind Beispiele und sollten für eure tatsächlichen Rezepte überprüft werden.</p>

            <div id="mealPortfolio" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </section>

        <section class="card">
            <h2 data-en="Weekly Meal Plan" data-de="Wöchentlicher Essensplan">Wöchentlicher Essensplan</h2>
            <p class="mb-4" data-en="Select meals for each day from your portfolio. The daily macro summary will update automatically." data-de="Wählt Mahlzeiten für jeden Tag aus eurem Portfolio aus. Die tägliche Makrozusammenfassung wird automatisch aktualisiert.">Wählt Mahlzeiten für jeden Tag aus eurem Portfolio aus. Die tägliche Makrozusammenfassung wird automatisch aktualisiert.</p>

            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr>
                            <th data-en="Day" data-de="Tag">Tag</th>
                            <th data-en="Breakfast" data-de="Frühstück">Frühstück</th>
                            <th data-en="Lunch" data-de="Mittagessen">Mittagessen</th>
                            <th data-en="Dinner" data-de="Abendessen">Abendessen</th>
                            <th data-en="Snacks" data-de="Snacks">Snacks</th>
                            <th data-en="Daily Macros" data-de="Tägliche Makros">Tägliche Makros</th>
                        </tr>
                    </thead>
                    <tbody id="mealPlanTableBody">
                        </tbody>
                </table>
            </div>
            <div class="chart-container mt-6">
                <h4 class="text-center" data-en="Daily Macro Distribution" data-de="Tägliche Makroverteilung">Tägliche Makroverteilung</h4>
                <canvas id="dailyMacroChart"></canvas>
                <p class="text-center text-sm text-gray-600 mt-2" data-en="Click on a day in the meal plan table to see its macro distribution." data-de="Klicke auf einen Tag in der Essensplantabelle, um dessen Makroverteilung zu sehen.">Klicke auf einen Tag in der Essensplantabelle, um dessen Makroverteilung zu sehen.</p>
            </div>
            <button onclick="saveMealPlan()" class="w-full mt-6" data-en="Save Weekly Meal Plan" data-de="Wöchentlichen Essensplan speichern">Wöchentlichen Essensplan speichern</button>
        </section>

        <section class="card">
            <h2 data-en="Tracking & Measurement" data-de="Tracking & Messung">Tracking & Messung</h2>
            <p class="mb-4" data-en="Track your progress over time. Add new entries to see your development." data-de="Verfolge deinen Fortschritt im Laufe der Zeit. Füge neue Einträge hinzu, um deine Entwicklung zu sehen.">Verfolge deinen Fortschritt im Laufe der Zeit. Füge neue Einträge hinzu, um deine Entwicklung zu sehen.</p>

            <h3 data-en="Your Tracking Data" data-de="Deine Tracking-Daten">Deine Tracking-Daten</h3>
            <table class="w-full text-sm">
                <thead>
                    <tr>
                        <th data-en="Date" data-de="Datum">Datum</th>
                        <th data-en="Weight (kg)" data-de="Gewicht (kg)">Gewicht (kg)</th>
                        <th data-en="Waist (cm)" data-de="Bauch (cm)">Bauch (cm)</th>
                        <th data-en="Notes" data-de="Notizen">Notizen</th>
                        <th data-en="Actions" data-de="Aktionen">Aktionen</th>
                    </tr>
                </thead>
                <tbody id="yourTrackingTableBody">
                    </tbody>
            </table>
            <div class="flex flex-wrap gap-4 mt-4">
                <input type="date" id="yourTrackingDate" class="p-2 border rounded" value="">
                <input type="number" id="yourTrackingWeight" class="p-2 border rounded w-24" placeholder="kg" step="0.1">
                <input type="number" id="yourTrackingWaist" class="p-2 border rounded w-24" placeholder="cm" step="0.1">
                <input type="text" id="yourTrackingNotes" class="p-2 border rounded flex-grow" placeholder="Notizen (z.B. Trainingsleistung)">
                <button onclick="addTrackingEntry('you')" data-en="Add Entry" data-de="Eintrag hinzufügen">Eintrag hinzufügen</button>
            </div>

            <h3 class="mt-8" data-en="Brother's Tracking Data" data-de="Tracking-Daten deines Bruders">Tracking-Daten deines Bruders</h3>
            <table class="w-full text-sm">
                <thead>
                    <tr>
                        <th data-en="Date" data-de="Datum">Datum</th>
                        <th data-en="Weight (kg)" data-de="Gewicht (kg)">Gewicht (kg)</th>
                        <th data-en="Arm (cm)" data-de="Arm (cm)">Arm (cm)</th>
                        <th data-en="Chest (cm)" data-de="Brust (cm)">Brust (cm)</th>
                        <th data-en="Notes" data-de="Notizen">Notizen</th>
                        <th data-en="Actions" data-de="Aktionen">Aktionen</th>
                    </tr>
                </thead>
                <tbody id="brotherTrackingTableBody">
                    </tbody>
            </table>
            <div class="flex flex-wrap gap-4 mt-4">
                <input type="date" id="brotherTrackingDate" class="p-2 border rounded" value="">
                <input type="number" id="brotherTrackingWeight" class="p-2 border rounded w-24" placeholder="kg" step="0.1">
                <input type="number" id="brotherTrackingArm" class="p-2 border rounded w-24" placeholder="Arm (cm)" step="0.1">
                <input type="number" id="brotherTrackingChest" class="p-2 border rounded w-24" placeholder="Brust (cm)" step="0.1">
                <input type="text" id="brotherTrackingNotes" class="p-2 border rounded flex-grow" placeholder="Notizen (z.B. Trainingsleistung)">
                <button onclick="addTrackingEntry('brother')" data-en="Add Entry" data-de="Eintrag hinzufügen">Eintrag hinzufügen</button>
            </div>
        </section>

        <p class="text-center mt-6 text-gray-600" data-en="Remember that consistency is key. There will be ups and downs, but stick with it! Always consult a doctor or nutritionist for health concerns." data-de="Denkt daran, dass Konsistenz der Schlüssel ist. Es wird Höhen und Tiefen geben, aber bleibt dran! Konsultiert bei gesundheitlichen Bedenken immer einen Arzt oder Ernährungsberater.">
            Denkt daran, dass Konsistenz der Schlüssel ist. Es wird Höhen und Tiefen geben, aber bleibt dran!
            Konsultiert bei gesundheitlichen Bedenken immer einen Arzt oder Ernährungsberater.
        </p>
    </div>

    <script>
        const texts = {
            de: {
                title: "Fitness- & Ernährungs-Tracker",
                yourProfile: "Dein Profil",
                yourData: "Deine Daten",
                ageYears: "Alter (Jahre)",
                heightCm: "Größe (cm)",
                weightKg: "Gewicht (kg)",
                activityLevel: "Aktivitätslevel",
                sedentary: "Sesshaft (wenig bis keine Bewegung)",
                lightlyActive: "Leicht aktiv (leichter Sport 1-3 Tage/Woche)",
                moderatelyActive: "Mäßig aktiv (moderater Sport 3-5 Tage/Woche)",
                veryActive: "Sehr aktiv (intensiver Sport 6-7 Tage/Woche)",
                extremelyActive: "Extrem aktiv (tägl. intensiver Sport/körperliche Arbeit)",
                targetCalorieIntake: "Ziel-Kalorienzufuhr",
                yourResults: "Deine Ergebnisse",
                goal: "Ziel:",
                weightLossMuscleGain: "Gewichtsreduktion & Muskelaufbau",
                muscleGain: "Muskelaufbau",
                bmi: "BMI:",
                bmr: "Grundumsatz (BMR):",
                tdee: "Gesamtumsatz (TDEE):",
                recommendedLoss: "Empfehlung zum Abnehmen:",
                recommendedGain: "Empfehlung zum Muskelaufbau:",
                yourTargetWeight: "Dein Zielgewicht:",
                approx: "ca.",
                saveYourProfile: "Profil speichern",
                brotherProfile: "Profil deines Bruders",
                brotherData: "Daten deines Bruders",
                ageYearsAssumed: "Alter (Jahre) (Angenommen: 25)",
                brothersResults: "Ergebnisse deines Bruders",
                hisTargetWeight: "Sein Zielgewicht:",
                focusComposition: "(Fokus auf Komposition)",
                saveBrotherProfile: "Profil des Bruders speichern",
                mealPortfolio: "Essensportfolio",
                mealPortfolioIntro: "Hier ist eine Auswahl an Gerichtideen mit Beispiel-Nährwerten. Passt Portionsgrößen an eure individuellen Kalorien- und Makroziele an. Hinweis: Diese Werte sind Beispiele und sollten für eure tatsächlichen Rezepte überprüft werden.",
                calories: "Kalorien",
                protein: "Protein",
                carbs: "Kohlenhydrate",
                fat: "Fett",
                weeklyMealPlan: "Wöchentlicher Essensplan",
                weeklyMealPlanIntro: "Wählt Mahlzeiten für jeden Tag aus eurem Portfolio aus. Die tägliche Makrozusammenfassung wird automatisch aktualisiert.",
                day: "Tag",
                breakfast: "Frühstück",
                lunch: "Mittagessen",
                dinner: "Abendessen",
                snacks: "Snacks",
                dailyMacros: "Tägliche Makros",
                macroDistribution: "Tägliche Makroverteilung",
                macroChartTip: "Klicke auf einen Tag in der Essensplantabelle, um dessen Makroverteilung zu sehen.",
                saveWeeklyMealPlan: "Wöchentlichen Essensplan speichern",
                trackingMeasurement: "Tracking & Messung",
                trackingIntro: "Verfolge deinen Fortschritt im Laufe der Zeit. Füge neue Einträge hinzu, um deine Entwicklung zu sehen.",
                yourTrackingData: "Deine Tracking-Daten",
                brotherTrackingData: "Tracking-Daten deines Bruders",
                date: "Datum",
                weightKg: "Gewicht (kg)",
                waistCm: "Bauch (cm)",
                armCm: "Arm (cm)",
                chestCm: "Brust (cm)",
                notes: "Notizen",
                actions: "Aktionen",
                addEntry: "Eintrag hinzufügen",
                delete: "Löschen",
                generalReminder: "Denkt daran, dass Konsistenz der Schlüssel ist. Es wird Höhen und Tiefen geben, aber bleibt dran! Konsultiert bei gesundheitlichen Bedenken immer einen Arzt oder Ernährungsberater.",
                bmiCategories: {
                    underweight: "Untergewicht",
                    normal: "Normalgewicht",
                    overweight: "Übergewicht",
                    obese: "Fettleibigkeit"
                }
            },
            en: {
                title: "Fitness & Nutrition Tracker",
                yourProfile: "Your Profile",
                yourData: "Your Data",
                ageYears: "Age (years)",
                heightCm: "Height (cm)",
                weightKg: "Weight (kg)",
                activityLevel: "Activity Level",
                sedentary: "Sedentary (little or no exercise)",
                lightlyActive: "Lightly active (light exercise/sports 1-3 days/week)",
                moderatelyActive: "Moderately active (moderate exercise/sports 3-5 days/week)",
                veryActive: "Very active (hard exercise/sports 6-7 days/week)",
                extremelyActive: "Extremely active (hard daily exercise/physical job)",
                targetCalorieIntake: "Target Calorie Intake",
                yourResults: "Your Results",
                goal: "Goal:",
                weightLossMuscleGain: "Weight Loss & Muscle Gain",
                muscleGain: "Muscle Gain",
                bmi: "BMI:",
                bmr: "Basal Metabolic Rate (BMR):",
                tdee: "Total Daily Energy Expenditure (TDEE):",
                recommendedLoss: "Recommended for Weight Loss:",
                recommendedGain: "Recommended for Muscle Gain:",
                yourTargetWeight: "Your Target Weight:",
                approx: "approx.",
                saveYourProfile: "Save Your Profile",
                brotherProfile: "Brother's Profile",
                brotherData: "Brother's Data",
                ageYearsAssumed: "Age (years) (Assumed: 25)",
                brothersResults: "Brother's Results",
                hisTargetWeight: "His Target Weight:",
                focusComposition: "(focus on composition)",
                saveBrotherProfile: "Save Brother's Profile",
                mealPortfolio: "Meal Portfolio",
                mealPortfolioIntro: "Here is a selection of meal ideas with example nutritional values. Adjust portion sizes to fit your individual calorie and macro goals. Note: These values are examples and should be verified for your actual recipes.",
                calories: "Calories",
                protein: "Protein",
                carbs: "Carbs",
                fat: "Fat",
                weeklyMealPlan: "Weekly Meal Plan",
                weeklyMealPlanIntro: "Select meals for each day from your portfolio. The daily macro summary will update automatically.",
                day: "Day",
                breakfast: "Breakfast",
                lunch: "Lunch",
                dinner: "Dinner",
                snacks: "Snacks",
                dailyMacros: "Daily Macros",
                macroDistribution: "Daily Macro Distribution",
                macroChartTip: "Click on a day in the meal plan table to see its macro distribution.",
                saveWeeklyMealPlan: "Save Weekly Meal Plan",
                trackingMeasurement: "Tracking & Measurement",
                trackingIntro: "Track your progress over time. Add new entries to see your development.",
                yourTrackingData: "Your Tracking Data",
                brotherTrackingData: "Brother's Tracking Data",
                date: "Date",
                weightKg: "Weight (kg)",
                waistCm: "Waist (cm)",
                armCm: "Arm (cm)",
                chestCm: "Chest (cm)",
                notes: "Notes",
                actions: "Actions",
                addEntry: "Add Entry",
                delete: "Delete",
                generalReminder: "Remember that consistency is key. There will be ups and downs, but stick with it! Always consult a doctor or nutritionist for health concerns.",
                bmiCategories: {
                    underweight: "Underweight",
                    normal: "Normal weight",
                    overweight: "Overweight",
                    obese: "Obese"
                }
            }
        };

        let currentLang = 'de';
        let chartInstance = null;
        let selectedMealId = null; // Track selected meal for portfolio modal

        const userData = {
            you: { age: 27, height: 187, weight: 94, activity: 1.55, calorieGoal: 2550, tracking: [] },
            brother: { age: 25, height: 194, weight: 80, activity: 1.55, calorieGoal: 3250, tracking: [] }
        };

        const mealPortfolio = [
            { id: 'oatmeal-protein', name: 'Haferflocken mit Protein & Beeren', calories: 450, protein: 30, carbs: 50, fat: 15 },
            { id: 'scrambled-eggs-veg', name: 'Rührei mit Gemüse & Vollkornbrot', calories: 400, protein: 25, carbs: 30, fat: 20 },
            { id: 'greek-yogurt', name: 'Griechischer Joghurt mit Obst & Samen', calories: 350, protein: 35, carbs: 40, fat: 8 },
            { id: 'chicken-rice-veg', name: 'Hähnchen mit Reis & Gemüse', calories: 600, protein: 50, carbs: 70, fat: 15 },
            { id: 'salmon-sweet-potato', name: 'Lachs mit Süßkartoffel & Brokkoli', calories: 550, protein: 40, carbs: 45, fat: 25 },
            { id: 'lentil-stew', name: 'Linsen-Eintopf mit Vollkornbrot', calories: 500, protein: 30, carbs: 60, fat: 12 },
            { id: 'tofu-stir-fry', name: 'Tofu-Pfanne mit Nudeln & Gemüse', calories: 580, protein: 35, carbs: 75, fat: 20 },
            { id: 'big-salad', name: 'Großer Salat mit Hähnchen/Kichererbsen', calories: 480, protein: 40, carbs: 30, fat: 20 },
            { id: 'lean-beef-stirfry', name: 'Mageres Rindfleisch Geschnetzeltes', calories: 620, protein: 55, carbs: 65, fat: 20 },
            { id: 'homemade-pizza', name: 'Vollkornpizza mit Gemüse & Schinken', calories: 700, protein: 40, carbs: 80, fat: 25 },
            { id: 'protein-shake', name: 'Proteinshake', calories: 150, protein: 25, carbs: 8, fat: 2 },
            { id: 'apple-peanutbutter', name: 'Apfel mit Erdnussbutter', calories: 250, protein: 5, carbs: 30, fat: 12 },
            { id: 'nuts-handful', name: 'Handvoll Nüsse', calories: 200, protein: 7, carbs: 10, fat: 18 },
            { id: 'cottage-cheese-rye', name: 'Hüttenkäse auf Roggenbrot', calories: 280, protein: 25, carbs: 25, fat: 8 }
        ];

        const daysOfWeek = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
        const mealsOfDay = ['Frühstück', 'Mittagessen', 'Abendessen', 'Snacks'];

        let weeklyMealPlan = JSON.parse(localStorage.getItem('weeklyMealPlan')) || {};
        if (Object.keys(weeklyMealPlan).length === 0) {
            daysOfWeek.forEach(day => {
                weeklyMealPlan[day] = {};
                mealsOfDay.forEach(meal => {
                    weeklyMealPlan[day][meal] = ''; // Initialize with empty selection
                });
            });
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang; // Set lang attribute for HTML
            document.title = document.querySelector('title').dataset[lang]; // Update title tag

            document.querySelectorAll('[data-de]').forEach(element => {
                if (lang === 'de') {
                    element.textContent = element.dataset.de;
                } else {
                    element.textContent = element.dataset.en;
                }
            });
            // Update options within selects manually
            document.querySelectorAll('#yourActivity option').forEach(option => {
                option.textContent = texts[lang][option.value === '1.2' ? 'sedentary' : option.value === '1.375' ? 'lightlyActive' : option.value === '1.55' ? 'moderatelyActive' : option.value === '1.725' ? 'veryActive' : 'extremelyActive'];
            });
            document.querySelectorAll('#brotherActivity option').forEach(option => {
                option.textContent = texts[lang][option.value === '1.2' ? 'sedentary' : option.value === '1.375' ? 'lightlyActive' : option.value === '1.55' ? 'moderatelyActive' : option.value === '1.725' ? 'veryActive' : 'extremelyActive'];
            });

            // Update BMI categories explicitly
            updateBMICategory('you');
            updateBMICategory('brother');
            updateTrackingTables(); // Re-render tracking table headers and content
            renderMealPortfolio(); // Re-render meal portfolio for names
            renderWeeklyMealPlan(); // Re-render weekly plan
        }

        function calculateBMI(weight, heightCm) {
            const heightM = heightCm / 100;
            return (weight / (heightM * heightM)).toFixed(2);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return texts[currentLang].bmiCategories.underweight;
            if (bmi >= 18.5 && bmi < 24.9) return texts[currentLang].bmiCategories.normal;
            if (bmi >= 24.9 && bmi < 29.9) return texts[currentLang].bmiCategories.overweight;
            return texts[currentLang].bmiCategories.obese;
        }

        function calculateBMR(age, weight, heightCm, gender = 'male') {
            // Mifflin-St Jeor formula for men
            // BMR = (10 × weight in kg) + (6.25 × height in cm) - (5 × age in years) + 5
            return (10 * weight) + (6.25 * heightCm) - (5 * age) + 5;
        }

        function calculateTDEE(bmr, activityFactor) {
            return bmr * activityFactor;
        }

        function calculateAndDisplayData(userType) {
            const age = parseFloat(document.getElementById(`${userType}Age`).value);
            const height = parseFloat(document.getElementById(`${userType}Height`).value);
            const weight = parseFloat(document.getElementById(`${userType}Weight`).value);
            const activityFactor = parseFloat(document.getElementById(`${userType}Activity`).value);

            if (isNaN(age) || isNaN(height) || isNaN(weight) || isNaN(activityFactor)) {
                // Handle incomplete data gracefully, maybe clear results or show error
                document.getElementById(`${userType}BMI`).textContent = '';
                document.getElementById(`${userType}BMICategory`).textContent = '';
                document.getElementById(`${userType}BMR`).textContent = '';
                document.getElementById(`${userType}TDEE`).textContent = '';
                document.getElementById(`${userType}RecommendedLoss`).textContent = '';
                document.getElementById(`${userType}RecommendedGain`).textContent = '';
                return;
            }

            const bmi = calculateBMI(weight, height);
            const bmr = calculateBMR(age, weight, height);
            const tdee = calculateTDEE(bmr, activityFactor);

            document.getElementById(`${userType}BMI`).textContent = bmi;
            document.getElementById(`${userType}BMR`).textContent = bmr.toFixed(0);
            document.getElementById(`${userType}TDEE`).textContent = tdee.toFixed(0);

            updateBMICategory(userType, bmi);

            if (userType === 'you') {
                const targetLoss = `${(tdee - parseFloat(document.getElementById('yourCalorieGoal').value)).toFixed(0)} kcal Defizit`;
                document.getElementById('yourRecommendedLoss').textContent = targetLoss;
            } else { // brother
                const targetGain = `${(parseFloat(document.getElementById('brotherCalorieGoal').value) - tdee).toFixed(0)} kcal Überschuss`;
                document.getElementById('brotherRecommendedGain').textContent = targetGain;
            }

            // Save immediately after calculation
            saveUserData();
        }

        function updateBMICategory(userType, bmiValue = null) {
            const bmi = bmiValue !== null ? bmiValue : parseFloat(document.getElementById(`${userType}BMI`).textContent);
            const categoryElement = document.getElementById(`${userType}BMICategory`);
            if (!isNaN(bmi)) {
                categoryElement.textContent = `(${getBMICategory(bmi)})`;
            } else {
                categoryElement.textContent = '';
            }
        }

        function saveUserData() {
            userData.you.age = parseFloat(document.getElementById('yourAge').value);
            userData.you.height = parseFloat(document.getElementById('yourHeight').value);
            userData.you.weight = parseFloat(document.getElementById('yourWeight').value);
            userData.you.activity = parseFloat(document.getElementById('yourActivity').value);
            userData.you.calorieGoal = parseFloat(document.getElementById('yourCalorieGoal').value);

            userData.brother.age = parseFloat(document.getElementById('brotherAge').value);
            userData.brother.height = parseFloat(document.getElementById('brotherHeight').value);
            userData.brother.weight = parseFloat(document.getElementById('brotherWeight').value);
            userData.brother.activity = parseFloat(document.getElementById('brotherActivity').value);
            userData.brother.calorieGoal = parseFloat(document.getElementById('brotherCalorieGoal').value);

            localStorage.setItem('fitnessTrackerData', JSON.stringify(userData));
        }

        function loadUserData() {
            const storedData = localStorage.getItem('fitnessTrackerData');
            if (storedData) {
                const parsedData = JSON.parse(storedData);
                Object.assign(userData.you, parsedData.you);
                Object.assign(userData.brother, parsedData.brother);
            }

            // Populate input fields
            document.getElementById('yourAge').value = userData.you.age;
            document.getElementById('yourHeight').value = userData.you.height;
            document.getElementById('yourWeight').value = userData.you.weight;
            document.getElementById('yourActivity').value = userData.you.activity;
            document.getElementById('yourCalorieGoal').value = userData.you.calorieGoal;

            document.getElementById('brotherAge').value = userData.brother.age;
            document.getElementById('brotherHeight').value = userData.brother.height;
            document.getElementById('brotherWeight').value = userData.brother.weight;
            document.getElementById('brotherActivity').value = userData.brother.activity;
            document.getElementById('brotherCalorieGoal').value = userData.brother.calorieGoal;

            // Recalculate and display immediately
            calculateAndDisplayData('you');
            calculateAndDisplayData('brother');

            // Load tracking data
            loadTrackingData('you');
            loadTrackingData('brother');
        }

        function renderMealPortfolio() {
            const portfolioContainer = document.getElementById('mealPortfolio');
            portfolioContainer.innerHTML = ''; // Clear previous content

            mealPortfolio.forEach(meal => {
                const mealDiv = document.createElement('div');
                mealDiv.className = 'card meal-item flex flex-col justify-between';
                mealDiv.innerHTML = `
                    <h4 class="text-emerald-700">${meal.name}</h4>
                    <p class="text-gray-700 text-sm"><strong data-en="Calories" data-de="Kalorien">Kalorien</strong>: ${meal.calories} kcal</p>
                    <p class="text-gray-700 text-sm"><strong data-en="Protein" data-de="Protein">Protein</strong>: ${meal.protein}g</p>
                    <p class="text-gray-700 text-sm"><strong data-en="Carbs" data-de="Kohlenhydrate">Kohlenhydrate</strong>: ${meal.carbs}g</p>
                    <p class="text-gray-700 text-sm"><strong data-en="Fat" data-de="Fett">Fett</strong>: ${meal.fat}g</p>
                `;
                mealDiv.dataset.mealId = meal.id;
                portfolioContainer.appendChild(mealDiv);
            });
            setLanguage(currentLang); // Reapply language for dynamically added elements
        }

        function renderWeeklyMealPlan() {
            const tableBody = document.getElementById('mealPlanTableBody');
            tableBody.innerHTML = '';

            daysOfWeek.forEach(day => {
                const row = tableBody.insertRow();
                row.className = 'cursor-pointer hover:bg-gray-50'; // Make row clickable for chart
                row.dataset.day = day; // Add data attribute for click handling

                const dayCell = row.insertCell();
                dayCell.textContent = texts[currentLang].day === "Day" ? day : day.replace('Montag', 'Mo').replace('Dienstag', 'Di').replace('Mittwoch', 'Mi').replace('Donnerstag', 'Do').replace('Freitag', 'Fr').replace('Samstag', 'Sa').replace('Sonntag', 'So'); // Abbreviate days if in English
                dayCell.dataset.day = day; // Store full day name

                let totalCalories = 0;
                let totalProtein = 0;
                let totalCarbs = 0;
                let totalFat = 0;

                mealsOfDay.forEach(mealType => {
                    const cell = row.insertCell();
                    const currentMealId = weeklyMealPlan[day][mealType];
                    const selectedMeal = mealPortfolio.find(m => m.id === currentMealId);

                    const select = document.createElement('select');
                    select.className = 'w-full p-2 border rounded';
                    select.dataset.day = day;
                    select.dataset.mealType = mealType;
                    select.onchange = (event) => updateMealPlan(event.target.dataset.day, event.target.dataset.mealType, event.target.value);

                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = ''; // Empty option
                    select.appendChild(defaultOption);

                    mealPortfolio.forEach(meal => {
                        const option = document.createElement('option');
                        option.value = meal.id;
                        option.textContent = meal.name; // Keep original language for now
                        if (currentMealId === meal.id) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                    cell.appendChild(select);

                    if (selectedMeal) {
                        totalCalories += selectedMeal.calories;
                        totalProtein += selectedMeal.protein;
                        totalCarbs += selectedMeal.carbs;
                        totalFat += selectedMeal.fat;
                    }
                });

                const macrosCell = row.insertCell();
                macrosCell.innerHTML = `
                    <p class="text-sm">Kcal: ${totalCalories}</p>
                    <p class="text-sm">${texts[currentLang].protein}: ${totalProtein}g</p>
                    <p class="text-sm">${texts[currentLang].carbs}: ${totalCarbs}g</p>
                    <p class="text-sm">${texts[currentLang].fat}: ${totalFat}g</p>
                `;
                macrosCell.dataset.calories = totalCalories;
                macrosCell.dataset.protein = totalProtein;
                macrosCell.dataset.carbs = totalCarbs;
                macrosCell.dataset.fat = totalFat;

                row.onclick = (event) => {
                    const targetRow = event.target.closest('tr');
                    if (targetRow && targetRow.dataset.day) {
                        updateMacroChart(targetRow.dataset.day);
                    }
                };
            });
            setLanguage(currentLang); // Reapply language for dynamically added elements
        }

        function updateMealPlan(day, mealType, mealId) {
            weeklyMealPlan[day][mealType] = mealId;
            renderWeeklyMealPlan(); // Re-render the whole table to update macros
        }

        function saveMealPlan() {
            localStorage.setItem('weeklyMealPlan', JSON.stringify(weeklyMealPlan));
            alert(currentLang === 'de' ? 'Essensplan gespeichert!' : 'Meal plan saved!');
        }

        let macroChart;
        function initMacroChart() {
            const ctx = document.getElementById('dailyMacroChart').getContext('2d');
            macroChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [texts[currentLang].protein, texts[currentLang].carbs, texts[currentLang].fat],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#10B981', '#3B82F6', '#F59E0B'], // Emerald, Blue, Yellow
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    return `${label}: ${value}g`;
                                },
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                        return label.join(' ');
                                    } else {
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateMacroChart(day) {
            const row = document.querySelector(`#mealPlanTableBody tr[data-day="${day}"]`);
            if (!row) return;

            const protein = parseFloat(row.querySelector('[data-protein]').dataset.protein);
            const carbs = parseFloat(row.querySelector('[data-carbs]').dataset.carbs);
            const fat = parseFloat(row.querySelector('[data-fat]').dataset.fat);

            macroChart.data.labels = [texts[currentLang].protein, texts[currentLang].carbs, texts[currentLang].fat];
            macroChart.data.datasets[0].data = [protein, carbs, fat];
            macroChart.update();
        }

        function addTrackingEntry(userType) {
            const date = document.getElementById(`${userType}TrackingDate`).value;
            const weight = parseFloat(document.getElementById(`${userType}TrackingWeight`).value);
            const notes = document.getElementById(`${userType}TrackingNotes`).value;

            if (!date || isNaN(weight)) {
                alert(currentLang === 'de' ? 'Bitte Datum und Gewicht eingeben.' : 'Please enter date and weight.');
                return;
            }

            let newEntry = { date, weight, notes };

            if (userType === 'you') {
                const waist = parseFloat(document.getElementById('yourTrackingWaist').value);
                if (!isNaN(waist)) newEntry.waist = waist;
            } else { // brother
                const arm = parseFloat(document.getElementById('brotherTrackingArm').value);
                const chest = parseFloat(document.getElementById('brotherTrackingChest').value);
                if (!isNaN(arm)) newEntry.arm = arm;
                if (!isNaN(chest)) newEntry.chest = chest;
            }

            userData[userType].tracking.push(newEntry);
            saveUserData();
            updateTrackingTables();
            clearTrackingInputs(userType);
        }

        function deleteTrackingEntry(userType, index) {
            if (confirm(currentLang === 'de' ? 'Bist du sicher, dass du diesen Eintrag löschen möchtest?' : 'Are you sure you want to delete this entry?')) {
                userData[userType].tracking.splice(index, 1);
                saveUserData();
                updateTrackingTables();
            }
        }

        function clearTrackingInputs(userType) {
            document.getElementById(`${userType}TrackingDate`).value = '';
            document.getElementById(`${userType}TrackingWeight`).value = '';
            document.getElementById(`${userType}TrackingNotes`).value = '';
            if (userType === 'you') {
                document.getElementById('yourTrackingWaist').value = '';
            } else {
                document.getElementById('brotherTrackingArm').value = '';
                document.getElementById('brotherTrackingChest').value = '';
            }
        }

        function updateTrackingTables() {
            const yourTableBody = document.getElementById('yourTrackingTableBody');
            const brotherTableBody = document.getElementById('brotherTrackingTableBody');

            yourTableBody.innerHTML = '';
            brotherTableBody.innerHTML = '';

            userData.you.tracking.forEach((entry, index) => {
                const row = yourTableBody.insertRow();
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.weight}</td>
                    <td>${entry.waist !== undefined ? entry.waist : ''}</td>
                    <td>${entry.notes}</td>
                    <td><button onclick="deleteTrackingEntry('you', ${index})" class="bg-red-500 hover:bg-red-600 px-3 py-1 text-sm">${texts[currentLang].delete}</button></td>
                `;
            });

            userData.brother.tracking.forEach((entry, index) => {
                const row = brotherTableBody.insertRow();
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.weight}</td>
                    <td>${entry.arm !== undefined ? entry.arm : ''}</td>
                    <td>${entry.chest !== undefined ? entry.chest : ''}</td>
                    <td>${entry.notes}</td>
                    <td><button onclick="deleteTrackingEntry('brother', ${index})" class="bg-red-500 hover:bg-red-600 px-3 py-1 text-sm">${texts[currentLang].delete}</button></td>
                `;
            });
            setLanguage(currentLang); // Reapply language for dynamically added buttons
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
            renderMealPortfolio();
            renderWeeklyMealPlan();
            initMacroChart();
            setLanguage(navigator.language.startsWith('en') ? 'en' : 'de'); // Set initial language based on browser or default
            
            // Set current date for tracking inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('yourTrackingDate').value = today;
            document.getElementById('brotherTrackingDate').value = today;
        });
    </script>
</body>
</html>